import{b as E,d as I,e as k,f as z,g as G,o as A,t as m,h as F,i as n,j as M,c as p,m as L,B as j,a as $,s as O,S as R,k as H}from"./index-BBwV2Uvf.js";import{S as _,L as r}from"./Singleton-BNqru5cl.js";var N=m("<svg stroke-width=0>");function U(s,t){const g=E(s.a,t),[a,d]=I(g,["src"]),[l,w]=k(""),f=z(()=>t.title?`${s.c}<title>${t.title}</title>`:s.c);return G(()=>w(f())),A(()=>{w("")}),(()=>{var o=N();return F(o,E({get stroke(){return s.a?.stroke},get color(){return t.color||"currentColor"},get fill(){return t.color||"currentColor"},get style(){return{...t.style,overflow:"visible"}}},d,{get height(){return t.size||"1em"},get width(){return t.size||"1em"},xmlns:"http://www.w3.org/2000/svg",get innerHTML(){return l()}}),!0),n(o,()=>M),o})()}function D(s){return U({a:{viewBox:"0 0 24 24"},c:'<path d="M12.707 17.293 8.414 13H18v-2H8.414l4.293-4.293-1.414-1.414L4.586 12l6.707 6.707z"/>'},s)}var W=m('<div role=alert class="alert alert-success"><svg xmlns=http://www.w3.org/2000/svg class="h-6 w-6 shrink-0 stroke-current"fill=none viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>'),q=m('<div class="hero bg-base-200 min-h-screen"><div class="hero-content sm:min-w-auto min-w-full"><div class="flex flex-col gap-5 min-w-full"><h1 class="text-5xl font-bold"></h1><div class="card bg-base-100 w-full max-w-sm sm:min-w-100 min-w-full shrink-0 shadow-2xl"><div class=card-body><fieldset class=fieldset><a class="btn btn-ghost btn-square"></a><label class=label></label><input class="input min-w-full"><label class=label></label><input class="input min-w-full"type=password><button id=login-button class="btn btn-primary mt-3">'),J=m('<div role=alert class="alert alert-error"><svg xmlns=http://www.w3.org/2000/svg class="h-6 w-6 shrink-0 stroke-current"fill=none viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>'),K=m('<span class="loading loading-spinner loading-md">');const V=()=>{document.title=_?.forumName??"null";let s;(l=>{l[l.FIRST_LOAD=0]="FIRST_LOAD",l[l.LOGGING=1]="LOGGING",l[l.ERROR=2]="ERROR",l[l.SUCCESS=3]="SUCCESS"})(s||(s={}));const[t,g]=k({username:"",password:""}),[a,d]=k([0,""]);return(()=>{var l=q(),w=l.firstChild,f=w.firstChild,o=f.firstChild,T=o.nextSibling,B=T.firstChild,x=B.firstChild,h=x.firstChild,C=h.nextSibling,v=C.nextSibling,S=v.nextSibling,u=S.nextSibling,b=u.nextSibling;return n(o,()=>r?.login),n(x,p(R,{get when(){return a()[0]===3},get fallback(){return p(R,{get when(){return a()[0]===2},get children(){var e=J(),c=e.firstChild,i=c.nextSibling;return n(i,()=>r?.loginFailed,null),n(i,()=>a()[1],null),e}})},get children(){var e=W(),c=e.firstChild,i=c.nextSibling;return n(i,()=>r?.loginSucceed),e}}),h),h.$$click=()=>{history.back()},n(h,p(D,{size:"2rem"})),n(C,(()=>{var e=L(()=>!!_?.enableLoginWithEmail);return()=>e()?r?.usernameOrEmail:r?.username})()),v.addEventListener("change",e=>{g({...t(),username:e.target.value})}),n(S,()=>r?.password),u.$$input=e=>{console.log("changed"),g({...t(),password:e.currentTarget.value})},u.$$keydown=e=>{e.key==="Enter"&&document.getElementById("login-button").click()},b.$$click=async()=>{d([1,a()[1]]);let e=await fetch(j+"/api/bbs/user/login",{method:"POST",body:JSON.stringify({username:t().username,password:t().password}),headers:{"Content-Type":"application/json"},credentials:"include"});e.ok?(d([3,a()[1]]),setTimeout(()=>{window.location.replace("/")},1e3)):e.status===409?alert("Having two accounts with same email. "):d([2,e.statusText])},n(b,(()=>{var e=L(()=>a()[0]===1);return()=>e()?K():r?.login})()),$(e=>{var c=_?.enableLoginWithEmail?r?.usernameOrEmail:r?.username,i=r?.password,y=a()[0]===1;return c!==e.e&&O(v,"placeholder",e.e=c),i!==e.t&&O(u,"placeholder",e.t=i),y!==e.a&&(b.disabled=e.a=y),e},{e:void 0,t:void 0,a:void 0}),$(()=>v.value=t().username),$(()=>u.value=t().password),l})()};H(["click","keydown","input"]);export{V as default};
